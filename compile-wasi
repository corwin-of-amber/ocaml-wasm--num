WASI_SDK=${WASI_SDK:=/opt/wasi-sdk}
WASIK_INC=${WASI_INC:=/tmp/wasi-kit-hijack/include}

OCAML_SRC=${OCAML_SRC:=../ocaml}

CCSHARED="$WASI_SDK/bin/clang -target wasm32-unknown-emscripten -D__wasi__ -fPIC -Wl,--shared"
CCFLAGS="-Os -nostdlib -Wl,--export-all -include $WASIK_INC/etc.h -I $WASIK_INC -I $OCAML_SRC/runtime"

mkdir -p bin

$CCSHARED $CCFLAGS src/nat_stubs.c src/bng.c -DBNG_ARCH_generic -o bin/dllnums.wasm
